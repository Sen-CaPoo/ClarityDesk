# Feature Specification: 顧客問題紀錄追蹤系統

**Feature Branch**: `001-customer-issue-tracker`  
**Created**: 2025年10月20日  
**Status**: Draft  
**Input**: 使用者描述: "開發一個網站,功能是讓使用者可以簡易快速的填寫顧客的問題紀錄表。"

## Clarifications

### Session 2025-10-20

- Q: 回報單資料應該如何儲存?這會影響架構設計、資料持久性策略與部署方式。 → A: Azure SQL Database
- Q: 回報單的「處理狀態」應該包含哪些階段?這會影響工作流程設計與狀態轉換邏輯。 → A: 簡易 3 狀態: 待處理 → 處理中 → 已完成
- Q: 回報單的「緊急程度」應該如何分級?這會影響問題優先順序排序與 SLA 設計。 → A: 3 級制: 高、中、低
- Q: 使用者登入後的會話應該維持多久?這會影響安全性設計與使用者體驗。 → A: 永久,直到手動登出
- Q: 回報單列表頁面的預設排序方式為何?這會影響使用者介面設計與查詢效能。 → A: 按建立時間倒序 (最新建立在前)

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 普通使用者建立與管理回報單 (Priority: P1)

作為一位普通使用者,我需要能夠快速記錄顧客的問題,包括問題詳情、緊急程度、負責單位等資訊,以便追蹤和處理顧客問題。

**Why this priority**: 這是系統的核心價值所在,讓使用者能夠記錄和追蹤顧客問題是最基本且最重要的功能。沒有這個功能,系統就失去存在意義。

**Independent Test**: 使用者可以完整地建立、檢視、編輯和刪除回報單,並透過篩選條件查詢特定回報單,這個功能獨立運作即可提供完整的問題追蹤價值。

**Acceptance Scenarios**:

1. **Given** 使用者已登入系統, **When** 使用者選擇新增回報單並填寫所有必要欄位(標題、內文、紀錄日期、問題所屬單位、緊急程度、處理狀態、指派處理人員、顧客聯絡人姓名、顧客連絡電話、回報人姓名), **Then** 系統儲存回報單並顯示成功訊息,且自動記錄建立時間
2. **Given** 系統中存在多筆回報單, **When** 使用者進入回報單列表頁面, **Then** 系統顯示所有回報單清單,並提供篩選條件(如:緊急程度、處理狀態、問題所屬單位、日期範圍)
3. **Given** 使用者檢視特定回報單, **When** 使用者點擊編輯並修改任一欄位內容, **Then** 系統更新該回報單並記錄最後修改時間
4. **Given** 使用者檢視特定回報單, **When** 使用者選擇刪除該回報單並確認刪除動作, **Then** 系統永久移除該回報單並返回列表頁面

---

### User Story 2 - 使用者透過 LINE 註冊與登入 (Priority: P2)

作為一位新使用者,我需要透過 LINE 帳號快速註冊並登入系統,以便開始使用問題記錄功能,而不需要另外記憶帳號密碼。

**Why this priority**: 身份驗證是使用系統的前提,但相較於核心的問題追蹤功能屬於次要優先級。可以先用簡單的認證方式建立 MVP,之後再整合 LINE 登入。

**Independent Test**: 使用者可以完整地透過 LINE 進行註冊、登入,並以普通使用者身份訪問系統,這個流程獨立測試即可驗證身份驗證機制。

**Acceptance Scenarios**:

1. **Given** 使用者尚未註冊且未登入, **When** 使用者嘗試訪問系統任何功能, **Then** 系統導向登入頁面
2. **Given** 使用者在登入頁面, **When** 使用者點擊"使用 LINE 登入"按鈕, **Then** 系統導向 LINE 授權頁面
3. **Given** 使用者首次透過 LINE 授權, **When** 授權成功, **Then** 系統建立新帳號並設定權限為"普通使用者",然後自動登入系統
4. **Given** 使用者已註冊過, **When** 使用者透過 LINE 授權成功, **Then** 系統直接登入並導向主頁面

---

### User Story 3 - 管理人員進行使用者權限管理 (Priority: P3)

作為一位管理人員,我需要查看所有註冊使用者並調整他們的權限(普通使用者或管理人員),以便控制誰可以訪問系統管理功能。

**Why this priority**: 權限管理屬於進階管理功能,在初期 MVP 階段可以手動在資料庫調整,等系統穩定後再加入此功能。

**Independent Test**: 管理人員可以查看使用者清單、變更任何使用者的權限角色,並驗證權限變更後的訪問控制,這個功能可獨立測試管理機制。

**Acceptance Scenarios**:

1. **Given** 使用者具有管理人員權限, **When** 使用者訪問系統管理功能, **Then** 系統顯示管理選單,包含使用者權限管理和問題所屬單位維護
2. **Given** 管理人員在使用者權限管理頁面, **When** 管理人員檢視使用者清單, **Then** 系統顯示所有已註冊使用者及其目前權限角色
3. **Given** 管理人員選擇特定使用者, **When** 管理人員將該使用者的權限從"普通使用者"變更為"管理人員"(或反向), **Then** 系統更新該使用者權限並立即生效
4. **Given** 使用者具有普通使用者權限, **When** 使用者嘗試訪問系統管理功能, **Then** 系統拒絕訪問並顯示權限不足訊息

---

### User Story 4 - 管理人員維護問題所屬單位與處理人員 (Priority: P3)

作為一位管理人員,我需要維護問題所屬單位清單,並為每個單位指派預設的處理人員,以便回報單能正確分配給對應的負責人。

**Why this priority**: 這是系統管理的輔助功能,初期可以使用固定的單位清單,等系統使用一段時間後再根據實際需求動態調整。

**Independent Test**: 管理人員可以新增、編輯、刪除問題所屬單位,並為每個單位指派多位處理人員,這些設定會反映在回報單建立時的選項中,可獨立驗證配置管理功能。

**Acceptance Scenarios**:

1. **Given** 管理人員在問題所屬單位維護頁面, **When** 管理人員新增一個新單位名稱, **Then** 系統儲存該單位並在回報單的單位複選框中顯示
2. **Given** 管理人員檢視特定問題所屬單位, **When** 管理人員為該單位指派處理人員(從所有註冊使用者中選擇), **Then** 系統記錄該單位與處理人員的關聯
3. **Given** 使用者建立新回報單並選擇問題所屬單位, **When** 系統載入該單位的預設處理人員清單, **Then** 指派處理人員欄位自動填入或提供該單位的處理人員選項
4. **Given** 管理人員檢視問題所屬單位清單, **When** 管理人員刪除某個已不再使用的單位, **Then** 系統將該單位標記為"已停用",現有回報單仍顯示該單位名稱,但新回報單的單位選項中不再顯示此單位

---

### Edge Cases

- **未授權訪問**: 當未登入使用者嘗試直接訪問回報單管理或系統管理頁面時,系統應該重定向至登入頁面而不是顯示錯誤訊息
- **LINE 授權失敗**: 當使用者在 LINE 授權過程中取消或授權失敗時,系統應返回登入頁面並顯示友善的錯誤訊息
- **重複註冊**: 當已註冊的 LINE 使用者再次進行註冊流程時,系統應識別為已存在帳號並直接登入,而不是建立重複帳號
- **權限即時生效**: 當管理人員變更某使用者的權限時,若該使用者正在使用系統,權限變更應在其下次操作或頁面重新載入時生效
- **刪除回報單**: 當使用者刪除回報單時,系統應要求確認以防止誤刪
- **必填欄位驗證**: 當使用者建立或編輯回報單時未填寫必要欄位,系統應阻止提交並標示缺少的欄位
- **日期輸入**: 紀錄日期欄位應支援手動輸入及日期選擇器,並驗證日期格式的正確性
- **使用者帳號停用**: 系統不提供刪除使用者帳號功能,只能將帳號停用(停用後無法登入但所有歷史資料保留),已停用使用者仍會顯示在回報單的處理人員欄位中
- **多重篩選條件**: 當使用者同時使用多個篩選條件查詢回報單時,系統應採用 AND 邏輯(符合所有條件)
- **空白查詢結果**: 當篩選條件沒有符合的回報單時,系統應顯示"查無資料"訊息而非空白頁面
- **電話格式**: 顧客連絡電話欄位應接受多種格式(手機、市話、分機),並進行基本格式驗證

## Requirements *(mandatory)*

### Functional Requirements

#### 使用者註冊與登入

- **FR-001**: 系統必須要求使用者登入後才能使用任何功能
- **FR-002**: 系統必須提供 LINE OAuth 整合作為唯一的註冊與登入方式
- **FR-003**: 系統必須在使用者首次透過 LINE 授權時自動建立新帳號,並設定預設權限為"普通使用者"
- **FR-004**: 系統必須在使用者登入後維持登入狀態直到使用者手動登出(永久會話),不設定自動過期時間
- **FR-005**: 系統必須區分兩種權限角色:"普通使用者"和"管理人員"

#### 回報單管理

- **FR-006**: 系統必須允許所有已登入使用者建立新回報單
- **FR-006-A**: 系統必須使用 Azure SQL Database 作為主要資料儲存方案,確保資料持久性、支援多點存取與可擴展性
- **FR-007**: 回報單必須包含以下欄位:標題(必填)、內文(必填)、紀錄日期(必填)、問題所屬單位(必填,複選)、緊急程度(必填)、處理狀態(必填)、指派處理人員(必填)、顧客聯絡人姓名(必填)、顧客連絡電話(必填)、回報人姓名(必填)
- **FR-007-A**: 處理狀態欄位必須採用簡易 3 狀態流程:「待處理」→「處理中」→「已完成」,系統介面應清楚呈現此狀態轉換邏輯
- **FR-007-B**: 緊急程度欄位必須採用 3 級制分級:「高」、「中」、「低」,系統應以視覺化方式(如顏色標示)區分不同緊急程度
- **FR-008**: 系統必須自動記錄每張回報單的建立時間和最後修改時間
- **FR-009**: 系統必須允許所有已登入使用者檢視所有回報單清單
- **FR-009-A**: 回報單列表的預設排序必須按建立時間倒序顯示(最新建立的回報單在最前面),使用者也可以手動調整排序方式
- **FR-010**: 系統必須允許所有已登入使用者編輯任何現有的回報單
- **FR-011**: 系統必須允許所有已登入使用者刪除任何現有的回報單
- **FR-012**: 系統必須提供回報單篩選功能,至少包含以下篩選條件:緊急程度、處理狀態、問題所屬單位、日期範圍、指派處理人員
- **FR-013**: 系統必須在刪除回報單前要求使用者確認操作
- **FR-014**: 系統必須驗證所有必填欄位已填寫才允許儲存回報單

#### 系統管理功能

- **FR-015**: 系統必須限制只有"管理人員"權限的使用者才能訪問系統管理功能
- **FR-016**: "管理人員"權限的使用者必須同時能夠使用回報單管理功能
- **FR-017**: 系統必須提供使用者權限管理介面,顯示所有已註冊使用者清單及其目前權限
- **FR-018**: 系統必須允許管理人員變更任何使用者的權限角色(在"普通使用者"和"管理人員"之間切換)
- **FR-019**: 系統必須提供問題所屬單位維護功能,允許管理人員新增、編輯、刪除單位
- **FR-020**: 系統必須允許管理人員為每個問題所屬單位指派一位或多位預設處理人員
- **FR-021**: 指派處理人員的選項必須包含所有已註冊的使用者(不限權限)
- **FR-022**: 同一位使用者必須可以被指派到多個不同的問題所屬單位
- **FR-023-A**: 系統必須支援問題所屬單位的軟刪除機制,被標記為"已停用"的單位不會從資料庫中移除,現有回報單仍可顯示該單位名稱
- **FR-024-A**: 系統必須確保新建立的回報單只能選擇狀態為"啟用"的問題所屬單位
- **FR-025-A**: 系統必須支援使用者帳號的停用功能(而非刪除),停用後的使用者無法登入但其姓名與歷史記錄完整保留

#### 使用者介面

- **FR-023**: 系統必須採用商務白風格的視覺設計,以白色背景搭配淺藍色點綴,使用圓角卡片式設計,營造友善且具現代感的專業商務風格,參考 Notion 或 Trello 的視覺風格
- **FR-024**: 系統必須支援響應式網頁設計(RWD),在桌面、平板、手機裝置上都能正常顯示與操作
- **FR-025**: 系統必須全站使用正體中文(zh-TW)作為唯一語言
- **FR-026**: 系統必須提供清晰的錯誤訊息和操作回饋,以維持良好的使用者體驗
- **FR-027**: 系統介面必須保持簡潔,避免複雜的操作流程

### Key Entities

- **使用者 (User)**: 代表系統的註冊使用者,包含 LINE 帳號綁定資訊、權限角色(普通使用者或管理人員)、姓名等基本資料
- **回報單 (Issue Report)**: 代表一筆顧客問題記錄,包含標題、內文、日期、緊急程度、狀態、關聯的單位、處理人員、顧客資訊、建立時間、修改時間等欄位
- **問題所屬單位 (Department)**: 代表組織內的部門或單位,用於分類和分配回報單,每個單位可以有多位預設處理人員
- **處理人員指派 (Department Assignment)**: 代表單位與使用者之間的關聯,一個單位可以有多位處理人員,一位使用者也可以負責多個單位

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 使用者可以在 1 分鐘內完成新回報單的建立(從點擊新增到儲存完成)
- **SC-002**: 使用者可以在 30 秒內透過 LINE 完成註冊或登入流程
- **SC-003**: 系統在桌面、平板、手機三種裝置上的功能操作成功率達 95% 以上
- **SC-004**: 90% 的使用者在首次使用時無需額外說明即可成功建立回報單
- **SC-005**: 回報單列表頁面載入時間在 2 秒內完成(包含 100 筆回報單)
- **SC-006**: 篩選功能回應時間在 1 秒內顯示結果
- **SC-007**: 權限變更在 5 秒內生效(使用者下次操作時即可反映新權限)
- **SC-008**: 系統支援至少 50 位同時在線使用者而不影響效能
- **SC-009**: 所有頁面的使用者介面在不同螢幕尺寸下都能正確顯示且可操作(320px 至 1920px 寬度)
- **SC-010**: 使用者完成回報單建立、編輯、刪除操作後,系統提供即時回饋訊息的顯示率達 100%

